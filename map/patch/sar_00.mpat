#define .NpcID:Astro       01
#define .NpcID:Merlon      02
#define .NpcID:Daisy       03
#define .NpcID:ChetRippo   04
#define .NpcID:TestT       05

@ $Script_Main 
{
    Set   *GB_WorldLocation  .Location:GoombaRoad
    Call  SetCamPerspective  ( .Cam:Default 00000003 00000019 00000010 00001000 )
    Call  SetCamBGColor      ( .Cam:Default 00000000 00000000 00000000 )
    Call  SetCamEnabled      ( .Cam:Default .True )
    Call  SetCamLeadPlayer   ( .Cam:Default .False )
    Exec  $Script_SetupMusic
    Call  $Function_LuckyStar (  )
    Call  $Function_GetHammer (  )
%    Call $GivePartners ()
%    Call  AddCoin ( 50` )
    Set  *GB_StoryProgress  .Story:Ch0_FoundHammer
    Exec  $Script_BindStuff
    Exec  $Script_MakeNPCs
    Exec  $Script_EnterMap
    Return
    End
}

#new:Function $GivePartners 
{
	ORI v0, r0, 1 %loop count
	SAB v0, 8010F2A2 %set current partner to goombario
	ORI v1, r0, 0100 %parnter and max level
	LIO t0, 8010F2A4
	.loop
	SLL t1, v0, 3 %multiply loop count by sizeof partner struct
	ADDU t2, t1, t0 %get offset into struct
	SH v1, 0000 (t2) %set partner and upgrade
	SLTI t3, v0, 9 %8 partners
	BNE t3, r0, .loop
	ADDIU v0, v0, 1 %increment loop count
	JR RA
	ORI v0, r0, 2
}

#new:Function $Function_LuckyStar
{
   LI        V0, 1
   SAB       V0, 8010F29A
   JR        RA
   LI        V0, 2
}

#new:Function $Function_GetHammer
{
    LI        V0, 0
    SAB       V0, 8010F291
    JR        RA
    LI        V0, 2
}

#new:Script $Script_BindStuff
{
    Call EnableGroup ( ~Model:UnlockedShips .False )
    Bind $Script_ChooseShip1 .Trigger:WallPressA ~Collider:Ship1Collider 00000001 00000000
    If *MF_Ship2Unlocked == .True
        Call EnableModel ( ~Model:ShipQuestion2 .False )
        Call EnableGroup ( ~Model:Rocket2 .True )
        Bind $Script_ChooseShip2 .Trigger:WallPressA ~Collider:Ship2Collider 00000001 00000000
    EndIf
    If *MF_Ship3Unlocked == .True
        Call EnableModel ( ~Model:ShipQuestion3 .False )
        Bind $Script_ChooseShip3 .Trigger:WallPressA ~Collider:Ship3Collider 00000001 00000000
    EndIf
    If *MF_Ship4Unlocked == .True
        Call EnableModel ( ~Model:ShipQuestion4 .False )
        Call EnableGroup ( ~Model:Rocket4 .True )
        Bind $Script_ChooseShip4 .Trigger:WallPressA ~Collider:Ship4Collider 00000001 00000000
    EndIf
    If *MF_Ship5Unlocked == .True
        Call EnableModel ( ~Model:ShipQuestion5 .False )
        Call EnableGroup ( ~Model:Rocket5 .True )
        Bind $Script_ChooseShip5 .Trigger:WallPressA ~Collider:Ship5Collider 00000001 00000000
    EndIf
    Bind $Script_WallsOff .Trigger:FloorAbove ~Collider:OuterWallsOff 00000001 00000000
    Bind $Script_WallsOn .Trigger:FloorAbove ~Collider:OuterWallsOn 00000001 00000000
    Return
    End
}

#new:Script $Script_WallsOff
{
    Call EnableModel ( ~Model:OutsideWalls .False )
    Call EnableModel ( ~Model:OutsideFloor .False )
    Return
    End
}

#new:Script $Script_WallsOn
{
    Call EnableModel ( ~Model:OutsideWalls .True )
    Call EnableModel ( ~Model:OutsideFloor .True )
    Return
    End
}

#new:Script $Script_MakeNPCs
{
    Call  MakeNpcs  ( .False $NpcGroupList_Always )
    Return
    End
}

#new:NpcGroupList $NpcGroupList_Always
{
	00000004 $NpcGroup_Always 00000000
  %  00000001 $NpcGroup_Debug 00000000
    00000000 00000000 00000000
}

#new:NpcGroup $NpcGroup_Always
{
	.NpcID:Astro $NpcSettings_Standard ~Vec3f:Astro
	00000001 $Script_Init_Astro 00000000 00000000 00000000
	~NoDrops
	~Movement:Astro
	~AnimationTable:Astro
	00000000 00000000 00000000 001A0066 % Tattle ID
    %
    .NpcID:Merlon $NpcSettings_Standard ~Vec3f:Merlon
	00000001 $Script_Init_Merlon 00000000 00000000 00000000
	~NoDrops
	~Movement:Merlon
	~AnimationTable:Merlon
	00000000 00000000 00000000 001A0066 % Tattle ID
    %
    .NpcID:Daisy $NpcSettings_Standard ~Vec3f:Daisy
	00000001 $Script_Init_Daisy 00000000 00000000 00000000
	~NoDrops
	~Movement:Daisy
	~AnimationTable:Daisy
	00000000 00000000 00000000 001A0066 % Tattle ID
    %
    .NpcID:ChetRippo $NpcSettings_Standard ~Vec3f:ChetRippo
	00000001 $Script_Init_ChetRippo 00000000 00000000 00000000
	~NoDrops
	~Movement:ChetRippo
	~AnimationTable:ChetRippo
	00000000 00000000 00000000 001A0066 % Tattle ID
}

#new:NpcGroup $NpcGroup_Debug
{
	.NpcID:TestT $NpcSettings_Standard ~Vec3f:TestT
	00000001 $Script_Init_TestT 00000000 00000000 00000000
	~NoDrops
	~Movement:TestT
	~AnimationTable:TestT
	00000000 00000000 00000000 001A0066 % Tattle ID
}

#new:NpcSettings $NpcSettings_Standard
{
	00000000 001E0018 00000000 00000000 00000000 00000000 00000000 00000000
	00000000 00000000 00630000
}

#new:Script $Script_Init_Astro
{
    Call SetNpcYaw ( .Npc:Self 270` )
    Call  BindNpcInteract   ( .Npc:Self $Script_Interact_Astro )
    Return
    End
}

#new:Script $Script_Init_Merlon
{
   14:  Call  BindNpcInteract   ( .Npc:Self $Script_Interact_Merlon )
        Return
   1C:  End
}

#new:Script $Script_Init_Daisy
{
   14:  Call  BindNpcInteract   ( .Npc:Self $Script_Interact_Daisy )
        Return
   1C:  End
}

#new:Script $Script_Init_ChetRippo
{
   14:  Call  BindNpcInteract   ( .Npc:Self $Script_Interact_ChetRippo )
        Return
   1C:  End
}

#new:Script $Script_Init_TestT
{
   14:  Call  BindNpcInteract   ( .Npc:Self $Script_Interact_TestT )
        Return
   1C:  End
}

#new:Script $Script_Interact_TestT
{
  Call  SpeakToPlayer ( .Npc:Self 00830204 00830201 00000000 002F005F ) % String
  Call  ShowChoice ( 002F0060 )
  Switch *Var0 
  Case == 00000000
    Set *MF_Ship2Unlocked .True
    Set *MF_Ship3Unlocked .True
    Set *MF_Ship4Unlocked .True
    Set *MF_Ship5Unlocked .True
  Case == 00000001
  Case == 00000002
  EndSwitch
  Call CloseMessage ()
  Return
  End
}

#new:Script $Script_Interact_Astro
{
  Call  SpeakToPlayer ( .Npc:Self 00830404 00830401 00000000 002F0077 ) % String
  Call  ShowChoice ( 002F0001 )
  If *Var0 == 00000000
        Call CloseMessage ()
        Call SpeakToPlayer ( .NpcID:Astro 00830404 00830401 00000000 002F0065 )
        Call GotoMapSpecial ( "sar_02" ~Entry:sar_02:Entry0 0000000D )
  EndIf
  Call CloseMessage ()
  Return
  End
}

#new:Script $Script_Interact_Merlon
{
  Call  SpeakToPlayer ( .Npc:Self 00A50004 00A50001 00000000 002F0053 ) % String
  Return
  End
}

#new:Script $Script_Interact_Daisy
{
  If *MB_CurrentShip == 0`
    Call  SpeakToPlayer ( .Npc:Self 00010001 00010001 00000000 002F0054 ) % String
  Else
    Call  SpeakToPlayer ( .Npc:Self 00010001 00010001 00000000 002F0055 ) % String
    Call  ShowChoice ( 002F0001 )
    If *Var0 == 00000000
        Call DisablePlayerInput ( .True )
        Call CloseMessage ()
        Call UseSettingsFrom ( .Cam:Default 0` -100` 0` )
        Call  PanToTarget       ( .Cam:Default 00000000 00000001 )
        Wait 60`
        Call PlaySoundAtModel ( ~Model:OutDoor .Sound:MetalDoorOpen 00000000 )
        Call MakeLerp ( 0` -110` 60` .Easing:CosInOut )
            Loop
                Call  UpdateLerp ( )
                Call  TranslateModel ( ~Model:OutDoor *Var0 00000000 1` )
                Wait  1`
                If  *Var1  ==  00000000
                    BreakLoop
                EndIf
            EndLoop
        Wait 45`
        Call GetPlayerPos ( *Var0 *Var1 *Var2 )
        Call ResetCam ( .Cam:Default 5` )
        Wait 30`
        Call  $Function_80241E90    ( 00000001 00000001 ) % Get Goombario
        Call  SetNpcPos ( .Npc:Self 0` -100` 0` )
        Call  ModifyColliderFlags   ( 00000000 ~Collider:DoorCollider 7FFFFE00 )
        Call DisablePlayerInput ( .False )
    Else
        Call CloseMessage ()
    EndIf
  EndIf
  Return
  End
}

#new:Function $Function_80241E90
{
    0:  ADDIU     SP, SP, FFD8
    4:  SW        S2, 18 (SP)
    8:  COPY      S2, A0
    C:  SW        S1, 14 (SP)
   10:  COPY      S1, A1
   14:  SW        RA, 24 (SP)
   18:  SW        S4, 20 (SP)
   1C:  SW        S3, 1C (SP)
   20:  SW        S0, 10 (SP)
   24:  LW        S0, C (S2)
   28:  LW        A1, 0 (S0)
   2C:  JAL       ~Func:get_variable
   30:  ADDIU     S0, S0, 4
   34:  COPY      A0, S2
   38:  LW        A1, 0 (S0)
   3C:  JAL       ~Func:get_variable
   40:  COPY      S0, V0
   44:  COPY      A0, S0
   48:  JAL       ~Func:get_npc_safe
   4C:  COPY      S4, V0
   50:  LA        S3, 8010F290
   58:  BEQ       S1, R0, .o74
   5C:  COPY      S0, V0
   60:  LB        V0, 12 (S3)
   64:  BNEL      V0, R0, .o74
   68:  SW        R0, 70 (S2)
   6C:  LI        V0, 2
   70:  SW        V0, 70 (S2)
        .o74
   74:  LW        V1, 70 (S2)
   78:  LI        S1, 1
   7C:  BEQ       V1, S1, .oCC
   80:  SLTI      V0, V1, 2
   84:  BEQ       V0, R0, .o9C
   88:  LI        V0, 2
   8C:  BEQ       V1, R0, .oB4
   90:  CLEAR     V0
   94:  BEQ       R0, R0, .o164
   98:  NOP
        .o9C
   9C:  BEQ       V1, V0, .oEC
   A0:  LI        V0, 3
   A4:  BEQ       V1, V0, .o120
   A8:  CLEAR     V0
   AC:  BEQ       R0, R0, .o164
   B0:  NOP
        .oB4
   B4:  JAL       ~Func:switch_to_partner
   B8:  CLEAR     A0
   BC:  LI        V0, 1E
   C0:  SW        V0, 74 (S2)
   C4:  BEQ       R0, R0, .o160
   C8:  SW        S1, 70 (S2)
        .oCC
   CC:  LW        V0, 74 (S2)
   D0:  LI        V1, FFFF
   D4:  ADDIU     V0, V0, FFFF
   D8:  BNE       V0, V1, .o160
   DC:  SW        V0, 74 (S2)
   E0:  LI        V0, 2
   E4:  BEQ       R0, R0, .o160
   E8:  SW        V0, 70 (S2)
        .oEC
   EC:  COPY      A0, S0
   F0:  SLL       V0, S4, 18
   F4:  SRA       V0, V0, 15
   F8:  ADDU      V0, S3, V0
   FC:  SB        S4, 12 (S3)
  100:  JAL       ~Func:partner_clear_player_tracking
  104:  SB        S1, 14 (V0)
  108:  LB        A0, 12 (S3)
  10C:  JAL       800EB2A4
  110:  NOP
  114:  LI        V0, 3
  118:  BEQ       R0, R0, .o160
  11C:  SW        V0, 70 (S2)
        .o120
  120:  JAL       ~Func:get_npc_safe
  124:  LI        A0, FFFC
  128:  LW        A1, C (S0)
  12C:  JAL       ~Func:set_npc_yaw
  130:  COPY      A0, V0
  134:  COPY      A0, S0
  138:  LW        V0, 0 (S0)
  13C:  LI        V1, FFFB
  140:  AND       V0, V0, V1
  144:  JAL       ~Func:disable_npc_shadow
  148:  SW        V0, 0 (S0)
  14C:  LIF       F0, -1000.0
  154:  LI        V0, 2
  158:  BEQ       R0, R0, .o164
  15C:  SWC1      F0, 3C (S0)
        .o160
  160:  CLEAR     V0
        .o164
  164:  LW        RA, 24 (SP)
  168:  LW        S4, 20 (SP)
  16C:  LW        S3, 1C (SP)
  170:  LW        S2, 18 (SP)
  174:  LW        S1, 14 (SP)
  178:  LW        S0, 10 (SP)
  17C:  JR        RA
  180:  ADDIU     SP, SP, 28
}

#new:Script $Script_Interact_ChetRippo
{
    Call  SpeakToPlayer ( .Npc:Self 00A60004 00A60001 00000000 002F007A ) % String
    /%
  Call  SpeakToPlayer ( .Npc:Self 00A60004 00A60001 00000000 002F0056 ) % String
  Call  ShowCoinCounter ( .True )
  Call  SpeakToPlayer ( .Npc:Self 00A60004 00A60001 00000000 002F0057 ) % String
  Call  ShowChoice ( 002F0058 )
  Switch *Var0
  Case == 0`
    Call CloseMessage ()
    Set *MF_AnomaliesPlus .True
    Call  AddCoin ( -10` )
    Call  SpeakToPlayer ( .Npc:Self 00A60004 00A60001 00000000 002F0059 ) % String
    Call  ShowCoinCounter ( .False )
    Call  GetNpcPos ( .Npc:Self *Var0 *Var1 *Var2 )
    Call  PlaySoundAtNpc ( .Npc:Self .Sound:SmokeBurst 00000000 )
    Call  PlayEffect    ( ~FX:BigSmokePuff *Var0 *Var1 *Var2 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 )
    Call  SetNpcPos ( .Npc:Self 0` -100` 0` )
  Case == 1`
    Call CloseMessage ()
    Set *MF_AnomaliesMinus .True
    Call  AddCoin ( -10` )
    Call  SpeakToPlayer ( .Npc:Self 00A60004 00A60001 00000000 002F0059 ) % String
    Call  ShowCoinCounter ( .False )
    Call  GetNpcPos ( .Npc:Self *Var0 *Var1 *Var2 )
    Call  PlaySoundAtNpc ( .Npc:Self .Sound:SmokeBurst 00000000 )
    Call  PlayEffect    ( ~FX:BigSmokePuff *Var0 *Var1 *Var2 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 )
    Call  SetNpcPos ( .Npc:Self 0` -100` 0` )
  Case == 2`
    Call CloseMessage ()
    Set *MF_OopsAllAnomalies .True
    Call  AddCoin ( -25` )
    Call  SpeakToPlayer ( .Npc:Self 00A60004 00A60001 00000000 002F0059 ) % String
    Call  ShowCoinCounter ( .False )
    Call  GetNpcPos ( .Npc:Self *Var0 *Var1 *Var2 )
    Call  PlaySoundAtNpc ( .Npc:Self .Sound:SmokeBurst 00000000 )
    Call  PlayEffect    ( ~FX:BigSmokePuff *Var0 *Var1 *Var2 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 )
    Call  SetNpcPos ( .Npc:Self 0` -100` 0` )
  Case == 3`
    Call CloseMessage ()
    Call  ShowCoinCounter ( .False )
  EndSwitch
  %/
  Return
  End
}

#new:Script $Script_ChooseShip1
{
    If *MB_CurrentShip != 0`
        Call  DisablePlayerInput ( .True )
        Call  ShowMessageAtScreenPos    ( 002F005C  160`  40` ) % Choose Cruiser?
        Call  DisablePlayerInput ( .False )
        Return
    EndIf
    Call  DisablePlayerInput ( .True )
    Set *Var6 0`
    Switch *MB_Ship1HPComponent
    Case == 2`
        Set *Var7 15`
        Set *Var1 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var7 10`
        Set *Var1 002F005A
    Case == 0`
        Set *Var7 10`
        Set *Var1 002F0030
    EndSwitch
    Call SetMessageValue ( *Var7 00000000 )
    Switch *MB_Ship1FPComponent
    Case == 2`
        Set *Var4 10`
        Set *Var2 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var4 5`
        Set *Var2 002F005A
    Case == 0`
        Set *Var4 5`
        Set *Var2 002F0030
    EndSwitch
    Call SetMessageValue ( *Var4 00000001 )
    Switch *MB_Ship1BPComponent
    Case == 2`
        Set *Var5 6`
        Set *Var3 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var5 3`
        Set *Var3 002F005A
    Case == 0`
        Set *Var5 3`
        Set *Var3 002F0030
    EndSwitch
    Call SetMessageValue ( *Var5 00000002 )
    Call  ShowMessageAtScreenPos    ( 002F0026  160`  40` ) % Choose Cruiser?
    Call  ShowChoice ( 002F002E )
    Switch *Var0
    Case == 00000000
        Call  CloseMessage ()
        Set *MB_CurrentShip 1`
        If *MB_Ship1BadgeComponent == 2`
            Add *Var6 1`
        EndIf
        Exec $Script_AddStats
        Call EnableGroup ( ~Model:BadgeQuestionGroup .False )
        Call  MakeItemEntity    ( .Item:PowerSmash1 ~Vec3d:Badge1 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[0] *Var0
        Bind $Script_ChooseBadge1 .Trigger:WallPressA ~Collider:Badge1Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:Multibounce ~Vec3d:Badge2 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[1] *Var0
        Bind $Script_ChooseBadge2 .Trigger:WallPressA ~Collider:Badge2Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:HappyFlowerA ~Vec3d:Badge3 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[2] *Var0
        Bind $Script_ChooseBadge3 .Trigger:WallPressA ~Collider:Badge3Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:DodgeMaster ~Vec3d:Badge4 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[3] *Var0
        Bind $Script_ChooseBadge4 .Trigger:WallPressA ~Collider:Badge4Collider 00000001 00000000
        If *MB_Ship1BadgeComponent == 2`
            Call  ShowMessageAtScreenPos    ( 002F002C  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 3`
        Else
            Call  ShowMessageAtScreenPos    ( 002F002B  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 2`
        EndIf
    Case == 00000001
        Call  CloseMessage ()
    Case == 00000002
        Call  CloseMessage ()
        Switch *MB_Ship1BadgeComponent
        Case == 2`
            Set *Var4 002F0031
        Case == 1`
            Set *Var4 002F005A
        Case == 0`
            Set *Var4 002F0030
        EndSwitch
        Call  SetMessageString ( *Var1 00000000 )
        Call  SetMessageString ( *Var2 00000001 )
        Call  SetMessageString ( *Var3 00000002 )
        Call  SetMessageString ( *Var4 00000003 )
        Call  ShowMessageAtScreenPos    ( 002F002F  160`  40` ) % Modify Cruiser?
        Call  ShowChoice ( 002F0032 )
        Switch *Var0
        Case == 00000000
            Switch *MB_Ship1HPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship1HPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0034  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship1HPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_HPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship1HPComponent 2`
                    Sub *MB_HPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000001
            Switch *MB_Ship1FPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship1FPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0036  160`  40` ) % Removed FP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship1FPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
            Case == 0`
                If *MB_FPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship1FPComponent 2`
                    Sub *MB_FPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000002
            Switch *MB_Ship1BPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship1BPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0038  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship1BPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship1BPComponent 2`
                    Sub *MB_BPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000003
            Switch *MB_Ship1BadgeComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship1BadgeComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F003A  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship1BadgeComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BadgeComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship1BadgeComponent 2`
                    Sub *MB_BadgeComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Default
            Call  CloseMessage ()
        EndSwitch
    EndSwitch
    Call  DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_ChooseShip2
{
    If *MB_CurrentShip != 0`
        Call  DisablePlayerInput ( .True )
        Call  ShowMessageAtScreenPos    ( 002F005C  160`  40` ) % Already Chose
        Call  DisablePlayerInput ( .False )
        Return
    EndIf
    Call  DisablePlayerInput ( .True )
    Set *Var6 0`
    Switch *MB_Ship2HPComponent
    Case == 2`
        Set *Var7 25`
        Set *Var1 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var7 20`
        Set *Var1 002F005A
    Case == 0`
        Set *Var7 20`
        Set *Var1 002F0030
    EndSwitch
    Call SetMessageValue ( *Var7 00000000 )
    Switch *MB_Ship2FPComponent
    Case == 2`
        Set *Var4 5`
        Set *Var2 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var4 0`
        Set *Var2 002F005A
    Case == 0`
        Set *Var4 0`
        Set *Var2 002F0030
    EndSwitch
    Call SetMessageValue ( *Var4 00000001 )
    Switch *MB_Ship2BPComponent
    Case == 2`
        Set *Var5 3`
        Set *Var3 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var5 0`
        Set *Var3 002F005A
    Case == 0`
        Set *Var5 0`
        Set *Var3 002F0030
    EndSwitch
    Call SetMessageValue ( *Var5 00000002 )
    Call  ShowMessageAtScreenPos    ( 002F0027  160`  40` ) % Choose Cruiser?
    Call  ShowChoice ( 002F002E )
    Switch *Var0
    Case == 00000000
        Call  CloseMessage ()
        Set *MB_CurrentShip 2`
        If *MB_Ship2BadgeComponent == 2`
            Add *Var6 1`
        EndIf
        Exec $Script_AddStats
        Call EnableGroup ( ~Model:BadgeQuestionGroup .False )
        Call  MakeItemEntity    ( .Item:DamageDodgeA ~Vec3d:Badge1 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[0] *Var0
        Bind $Script_ChooseBadge1 .Trigger:WallPressA ~Collider:Badge1Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:HappyHeartA ~Vec3d:Badge2 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[1] *Var0
        Bind $Script_ChooseBadge2 .Trigger:WallPressA ~Collider:Badge2Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:SpikeShield ~Vec3d:Badge3 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[2] *Var0
        Bind $Script_ChooseBadge3 .Trigger:WallPressA ~Collider:Badge3Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:ZapTap ~Vec3d:Badge4 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[3] *Var0
        Bind $Script_ChooseBadge4 .Trigger:WallPressA ~Collider:Badge4Collider 00000001 00000000
        If *MB_Ship2BadgeComponent == 2`
            Call  ShowMessageAtScreenPos    ( 002F002C  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 3`
        Else
            Call  ShowMessageAtScreenPos    ( 002F002B  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 2`
        EndIf
    Case == 00000001
        Call  CloseMessage ()
    Case == 00000002
        Call  CloseMessage ()
        Switch *MB_Ship2BadgeComponent
        Case == 2`
            Set *Var4 002F0031
        Case == 1`
            Set *Var4 002F005A
        Case == 0`
            Set *Var4 002F0030
        EndSwitch
        Call  SetMessageString ( *Var1 00000000 )
        Call  SetMessageString ( *Var2 00000001 )
        Call  SetMessageString ( *Var3 00000002 )
        Call  SetMessageString ( *Var4 00000003 )
        Call  ShowMessageAtScreenPos    ( 002F002F  160`  40` ) % Modify Cruiser?
        Call  ShowChoice ( 002F0032 )
        Switch *Var0
        Case == 00000000
            Switch *MB_Ship2HPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship2HPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0034  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship2HPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_HPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship2HPComponent 2`
                    Sub *MB_HPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000001
            Switch *MB_Ship2FPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship2FPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0036  160`  40` ) % Removed FP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship2FPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
            Case == 0`
                If *MB_FPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship2FPComponent 2`
                    Sub *MB_FPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000002
            Switch *MB_Ship2BPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship2BPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0038  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship2BPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship2BPComponent 2`
                    Sub *MB_BPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000003
            Switch *MB_Ship2BadgeComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship2BadgeComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F003A  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship2BadgeComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BadgeComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship2BadgeComponent 2`
                    Sub *MB_BadgeComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Default
            Call  CloseMessage ()
        EndSwitch
    EndSwitch
    Call  DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_ChooseShip3
{
    If *MB_CurrentShip != 0`
        Call  DisablePlayerInput ( .True )
        Call  ShowMessageAtScreenPos    ( 002F005C  160`  40` ) % Already Chose
        Call  DisablePlayerInput ( .False )
        Return
    EndIf
    Call  DisablePlayerInput ( .True )
    Set *Var6 0`
    Switch *MB_Ship3HPComponent
    Case == 2`
        Set *Var7 5`
        Set *Var1 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var7 0`
        Set *Var1 002F005A
    Case == 0`
        Set *Var7 0`
        Set *Var1 002F0030
    EndSwitch
    Call SetMessageValue ( *Var7 00000000 )
    Switch *MB_Ship3FPComponent
    Case == 2`
        Set *Var4 10`
        Set *Var2 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var4 5`
        Set *Var2 002F005A
    Case == 0`
        Set *Var4 5`
        Set *Var2 002F0030
    EndSwitch
    Call SetMessageValue ( *Var4 00000001 )
    Switch *MB_Ship3BPComponent
    Case == 2`
        Set *Var5 12`
        Set *Var3 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var5 9`
        Set *Var3 002F005A
    Case == 0`
        Set *Var5 9`
        Set *Var3 002F0030
    EndSwitch
    Call SetMessageValue ( *Var5 00000002 )
    Call  ShowMessageAtScreenPos    ( 002F0028  160`  40` ) % Choose Cruiser?
    Call  ShowChoice ( 002F002E )
    Switch *Var0
    Case == 00000000
        Call  CloseMessage ()
        Set *MB_CurrentShip 3`
        If *MB_Ship3BadgeComponent == 2`
            Add *Var6 1`
        EndIf
        Exec $Script_AddStats
        Call EnableGroup ( ~Model:BadgeQuestionGroup .False )
        Call  MakeItemEntity    ( .Item:PowerRush ~Vec3d:Badge1 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[0] *Var0
        Bind $Script_ChooseBadge1 .Trigger:WallPressA ~Collider:Badge1Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:PowerQuake ~Vec3d:Badge2 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[1] *Var0
        Bind $Script_ChooseBadge2 .Trigger:WallPressA ~Collider:Badge2Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:PowerPlusA ~Vec3d:Badge3 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[2] *Var0
        Bind $Script_ChooseBadge3 .Trigger:WallPressA ~Collider:Badge3Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:PowerBounce ~Vec3d:Badge4 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[3] *Var0
        Bind $Script_ChooseBadge4 .Trigger:WallPressA ~Collider:Badge4Collider 00000001 00000000
        If *MB_Ship3BadgeComponent == 2`
            Call  ShowMessageAtScreenPos    ( 002F002C  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 3`
        Else
            Call  ShowMessageAtScreenPos    ( 002F002B  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 2`
        EndIf
    Case == 00000001
        Call  CloseMessage ()
    Case == 00000002
        Call  CloseMessage ()
        Switch *MB_Ship3BadgeComponent
        Case == 2`
            Set *Var4 002F0031
        Case == 1`
            Set *Var4 002F005A
        Case == 0`
            Set *Var4 002F0030
        EndSwitch
        Call  SetMessageString ( *Var1 00000000 )
        Call  SetMessageString ( *Var2 00000001 )
        Call  SetMessageString ( *Var3 00000002 )
        Call  SetMessageString ( *Var4 00000003 )
        Call  ShowMessageAtScreenPos    ( 002F002F  160`  40` ) % Modify Cruiser?
        Call  ShowChoice ( 002F0032 )
        Switch *Var0
        Case == 00000000
            Switch *MB_Ship3HPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship3HPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0034  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship3HPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_HPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship3HPComponent 2`
                    Sub *MB_HPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000001
            Switch *MB_Ship3FPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship3FPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0036  160`  40` ) % Removed FP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship3FPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
            Case == 0`
                If *MB_FPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship3FPComponent 2`
                    Sub *MB_FPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000002
            Switch *MB_Ship3BPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship3BPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0038  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship3BPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship3BPComponent 2`
                    Sub *MB_BPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000003
            Switch *MB_Ship3BadgeComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship3BadgeComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F003A  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship3BadgeComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BadgeComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship3BadgeComponent 2`
                    Sub *MB_BadgeComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Default
            Call  CloseMessage ()
        EndSwitch
    EndSwitch
    Call  DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_ChooseShip4
{
    If *MB_CurrentShip != 0`
        Call  DisablePlayerInput ( .True )
        Call  ShowMessageAtScreenPos    ( 002F005C  160`  40` ) % Already Chose
        Call  DisablePlayerInput ( .False )
        Return
    EndIf
    Call  DisablePlayerInput ( .True )
    Set *Var6 0`
    Switch *MB_Ship4HPComponent
    Case == 2`
        Set *Var7 10`
        Set *Var1 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var7 5`
        Set *Var1 002F005A
    Case == 0`
        Set *Var7 5`
        Set *Var1 002F0030
    EndSwitch
    Call SetMessageValue ( *Var7 00000000 )
    Switch *MB_Ship4FPComponent
    Case == 2`
        Set *Var4 15`
        Set *Var2 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var4 10`
        Set *Var2 002F005A
    Case == 0`
        Set *Var4 10`
        Set *Var2 002F0030
    EndSwitch
    Call SetMessageValue ( *Var4 00000001 )
    Switch *MB_Ship4BPComponent
    Case == 2`
        Set *Var5 6`
        Set *Var3 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var5 3`
        Set *Var3 002F005A
    Case == 0`
        Set *Var5 3`
        Set *Var3 002F0030
    EndSwitch
    Call SetMessageValue ( *Var5 00000002 )
    Call  ShowMessageAtScreenPos    ( 002F0029  160`  40` ) % Choose Cruiser?
    Call  ShowChoice ( 002F002E )
    Switch *Var0
    Case == 00000000
        Call  CloseMessage ()
        Set *MB_CurrentShip 4`
        If *MB_Ship4BadgeComponent == 2`
            Add *Var6 1`
        EndIf
        Exec $Script_AddStats
        Call EnableGroup ( ~Model:BadgeQuestionGroup .False )
        Call  MakeItemEntity    ( .Item:IcePower ~Vec3d:Badge1 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[0] *Var0
        Bind $Script_ChooseBadge1 .Trigger:WallPressA ~Collider:Badge1Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:MoneyMoney ~Vec3d:Badge2 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[1] *Var0
        Bind $Script_ChooseBadge2 .Trigger:WallPressA ~Collider:Badge2Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:PrettyLucky ~Vec3d:Badge3 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[2] *Var0
        Bind $Script_ChooseBadge3 .Trigger:WallPressA ~Collider:Badge3Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:SleepStomp ~Vec3d:Badge4 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[3] *Var0
        Bind $Script_ChooseBadge4 .Trigger:WallPressA ~Collider:Badge4Collider 00000001 00000000
        If *MB_Ship4BadgeComponent == 2`
            Call  ShowMessageAtScreenPos    ( 002F002C  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 3`
        Else
            Call  ShowMessageAtScreenPos    ( 002F002B  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 2`
        EndIf
    Case == 00000001
        Call  CloseMessage ()
    Case == 00000002
        Call  CloseMessage ()
        Switch *MB_Ship4BadgeComponent
        Case == 2`
            Set *Var4 002F0031
        Case == 1`
            Set *Var4 002F005A
        Case == 0`
            Set *Var4 002F0030
        EndSwitch
        Call  SetMessageString ( *Var1 00000000 )
        Call  SetMessageString ( *Var2 00000001 )
        Call  SetMessageString ( *Var3 00000002 )
        Call  SetMessageString ( *Var4 00000003 )
        Call  ShowMessageAtScreenPos    ( 002F002F  160`  40` ) % Modify Cruiser?
        Call  ShowChoice ( 002F0032 )
        Switch *Var0
        Case == 00000000
            Switch *MB_Ship4HPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship4HPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0034  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship4HPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_HPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship4HPComponent 2`
                    Sub *MB_HPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000001
            Switch *MB_Ship4FPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship4FPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0036  160`  40` ) % Removed FP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship4FPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
            Case == 0`
                If *MB_FPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship4FPComponent 2`
                    Sub *MB_FPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000002
            Switch *MB_Ship4BPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship4BPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0038  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship4BPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship4BPComponent 2`
                    Sub *MB_BPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000003
            Switch *MB_Ship4BadgeComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship4BadgeComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F003A  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship4BadgeComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BadgeComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship4BadgeComponent 2`
                    Sub *MB_BadgeComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Default
            Call  CloseMessage ()
        EndSwitch
    EndSwitch
    Call  DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_ChooseShip5
{
    If *MB_CurrentShip != 0`
        Call  DisablePlayerInput ( .True )
        Call  ShowMessageAtScreenPos    ( 002F005C  160`  40` ) % Already Chose
        Call  DisablePlayerInput ( .False )
        Return
    EndIf
    Call  DisablePlayerInput ( .True )
    Set *Var6 0`
    Switch *MB_Ship5HPComponent
    Case == 2`
        Set *Var7 5`
        Set *Var1 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var7 0`
        Set *Var1 002F005A
    Case == 0`
        Set *Var7 0`
        Set *Var1 002F0030
    EndSwitch
    Call SetMessageValue ( *Var7 00000000 )
    Switch *MB_Ship5FPComponent
    Case == 2`
        Set *Var4 20`
        Set *Var2 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var4 15`
        Set *Var2 002F005A
    Case == 0`
        Set *Var4 15`
        Set *Var2 002F0030
    EndSwitch
    Call SetMessageValue ( *Var4 00000001 )
    Switch *MB_Ship5BPComponent
    Case == 2`
        Set *Var5 6`
        Set *Var3 002F0031
        Add *Var6 1`
    Case == 1`
        Set *Var5 3`
        Set *Var3 002F005A
    Case == 0`
        Set *Var5 3`
        Set *Var3 002F0030
    EndSwitch
    Call SetMessageValue ( *Var5 00000002 )
    Call  ShowMessageAtScreenPos    ( 002F002A  160`  40` ) % Choose Cruiser?
    Call  ShowChoice ( 002F002E )
    Switch *Var0
    Case == 00000000
        Call  CloseMessage ()
        Set *MB_CurrentShip 5`
        If *MB_Ship5BadgeComponent == 2`
            Add *Var6 1`
        EndIf
        Exec $Script_AddStats
        Call EnableGroup ( ~Model:BadgeQuestionGroup .False )
        Call  MakeItemEntity    ( .Item:DoubleDip ~Vec3d:Badge1 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[0] *Var0
        Bind $Script_ChooseBadge1 .Trigger:WallPressA ~Collider:Badge1Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:FeelingFine ~Vec3d:Badge2 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[1] *Var0
        Bind $Script_ChooseBadge2 .Trigger:WallPressA ~Collider:Badge2Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:MegaQuake ~Vec3d:Badge3 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[2] *Var0
        Bind $Script_ChooseBadge3 .Trigger:WallPressA ~Collider:Badge3Collider 00000001 00000000
        Call  MakeItemEntity    ( .Item:MegaJump ~Vec3d:Badge4 .ItemSpawnMode:Decoration 00000000 )
        Set *MapVar[3] *Var0
        Bind $Script_ChooseBadge4 .Trigger:WallPressA ~Collider:Badge4Collider 00000001 00000000
        If *MB_Ship5BadgeComponent == 2`
            Call  ShowMessageAtScreenPos    ( 002F002C  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 3`
        Else
            Call  ShowMessageAtScreenPos    ( 002F002B  160`  40` ) % Choose Cruiser?
            Set *MB_StartingBadgesNumber 2`
        EndIf
    Case == 00000001
        Call  CloseMessage ()
    Case == 00000002
        Call  CloseMessage ()
        Switch *MB_Ship5BadgeComponent
        Case == 2`
            Set *Var4 002F0031
        Case == 1`
            Set *Var4 002F005A
        Case == 0`
            Set *Var4 002F0030
        EndSwitch
        Call  SetMessageString ( *Var1 00000000 )
        Call  SetMessageString ( *Var2 00000001 )
        Call  SetMessageString ( *Var3 00000002 )
        Call  SetMessageString ( *Var4 00000003 )
        Call  ShowMessageAtScreenPos    ( 002F002F  160`  40` ) % Modify Cruiser?
        Call  ShowChoice ( 002F0032 )
        Switch *Var0
        Case == 00000000
            Switch *MB_Ship5HPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship5HPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0034  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship5HPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_HPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship5HPComponent 2`
                    Sub *MB_HPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0033  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000001
            Switch *MB_Ship5FPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship5FPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0036  160`  40` ) % Removed FP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship5FPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
            Case == 0`
                If *MB_FPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship5FPComponent 2`
                    Sub *MB_FPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0035  160`  40` ) % Added FP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000002
            Switch *MB_Ship5BPComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship5BPComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F0038  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship5BPComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BPComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship5BPComponent 2`
                    Sub *MB_BPComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0037  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Case == 00000003
            Switch *MB_Ship5BadgeComponent
            Case == 2`
                Call  CloseMessage ()
                Set *MB_Ship5BadgeComponent 1`
                Call  ShowMessageAtScreenPos    ( 002F003A  160`  40` ) % Removed HP Component
            Case == 1`
                Call  CloseMessage ()
                Set *MB_Ship5BadgeComponent 2`
                Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
            Case == 0`
                If *MB_BadgeComponents >= 1`
                    Call  CloseMessage ()
                    Set *MB_Ship5BadgeComponent 2`
                    Sub *MB_BadgeComponents 1`
                    Call ShowMessageAtScreenPos    ( 002F0039  160`  40` ) % Added HP Component
                Else
                    Call  CloseMessage ()
                    Call ShowMessageAtScreenPos    ( 002F003B  160`  40` ) % No Component
                EndIf
            EndSwitch
        Default
            Call  CloseMessage ()
        EndSwitch
    EndSwitch
    Call  DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_AddStats
{
    Add *Var7 10` % New HP
    Add *Var4 5`  % New FP
    Add *Var5 3`  % New BP
    Add *Var6 5`  % New Level
    Call $WriteAddress ( 8010F292 0 *Var7 0 .False ) % HP
    Call $WriteAddress ( 8010F293 0 *Var7 0 .False ) % Max HP 1
    Call $WriteAddress ( 8010F294 0 *Var7 0 .False ) % Max HP 2
    Call $WriteAddress ( 8010F295 0 *Var4 0 .False ) % FP
    Call $WriteAddress ( 8010F296 0 *Var4 0 .False ) % Max FP 1
    Call $WriteAddress ( 8010F297 0 *Var4 0 .False ) % Max FP 2
    Call $WriteAddress ( 8010F298 0 *Var5 0 .False ) % Max BP
    Call $WriteAddress ( 8010F299 0 *Var6 0 .False ) % Lvl
    Return
    End
}

#new:Script $Script_ChooseBadge1
{
    Call DisablePlayerInput ( .True )
    If *MB_StartingBadgesNumber > 0`
        Switch *MB_CurrentShip
        Case == 1`
            Call ShowMessageAtScreenPos    ( 002F003C  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[0] )
                Call AddBadge ( .Item:PowerSmash1 *Var0 )
                Call ShowGotItem ( .Item:PowerSmash1 .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 2`
            Call ShowMessageAtScreenPos    ( 002F0041  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[0] )
                Call AddBadge ( .Item:DamageDodgeA *Var0 )
                Call ShowGotItem ( .Item:DamageDodgeA .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 3`
            Call ShowMessageAtScreenPos    ( 002F0045  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[0] )
                Call AddBadge ( .Item:PowerRush *Var0 )
                Call ShowGotItem ( .Item:PowerRush .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 4`
            Call ShowMessageAtScreenPos    ( 002F0049  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[0] )
                Call AddBadge ( .Item:IcePower *Var0 )
                Call ShowGotItem ( .Item:IcePower .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 5`
            Call ShowMessageAtScreenPos    ( 002F004D  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[0] )
                Call AddBadge ( .Item:DoubleDip *Var0 )
                Call ShowGotItem ( .Item:DoubleDip .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        EndSwitch
    Else
        Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
    EndIf
    Call DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_ChooseBadge2
{
    Call DisablePlayerInput ( .True )
    If *MB_StartingBadgesNumber > 0`
        Switch *MB_CurrentShip
        Case == 1`
            Call ShowMessageAtScreenPos    ( 002F003E  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[1] )
                Call AddBadge ( .Item:Multibounce *Var0 )
                Call ShowGotItem ( .Item:Multibounce .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 2`
            Call ShowMessageAtScreenPos    ( 002F0042  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[1] )
                Call AddBadge ( .Item:HappyHeartA *Var0 )
                Call ShowGotItem ( .Item:HappyHeartA .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 3`
            Call ShowMessageAtScreenPos    ( 002F0046  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[1] )
                Call AddBadge ( .Item:PowerQuake *Var0 )
                Call ShowGotItem ( .Item:PowerQuake .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 4`
            Call ShowMessageAtScreenPos    ( 002F004A  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[1] )
                Call AddBadge ( .Item:MoneyMoney *Var0 )
                Call ShowGotItem ( .Item:MoneyMoney .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 5`
            Call ShowMessageAtScreenPos    ( 002F004E  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[1] )
                Call AddBadge ( .Item:FeelingFine *Var0 )
                Call ShowGotItem ( .Item:FeelingFine .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        EndSwitch
    Else
        Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
    EndIf
    Call DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_ChooseBadge3
{
    Call DisablePlayerInput ( .True )
    If *MB_StartingBadgesNumber > 0`
        Switch *MB_CurrentShip
        Case == 1`
            Call ShowMessageAtScreenPos    ( 002F003F  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[2] )
                Call AddBadge ( .Item:HappyFlowerA *Var0 )
                Call ShowGotItem ( .Item:HappyFlowerA .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 2`
            Call ShowMessageAtScreenPos    ( 002F0043  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[2] )
                Call AddBadge ( .Item:SpikeShield *Var0 )
                Call ShowGotItem ( .Item:SpikeShield .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 3`
            Call ShowMessageAtScreenPos    ( 002F0047  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[2] )
                Call AddBadge ( .Item:PowerPlusA *Var0 )
                Call ShowGotItem ( .Item:PowerPlusA .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 4`
            Call ShowMessageAtScreenPos    ( 002F004B  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[2] )
                Call AddBadge ( .Item:PrettyLucky *Var0 )
                Call ShowGotItem ( .Item:PrettyLucky .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 5`
            Call ShowMessageAtScreenPos    ( 002F004F  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[2] )
                Call AddBadge ( .Item:MegaQuake *Var0 )
                Call ShowGotItem ( .Item:MegaQuake .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        EndSwitch
    Else
        Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
    EndIf
    Call DisablePlayerInput ( .False )
    Return
    End
}

#new:Script $Script_ChooseBadge4
{
    Call DisablePlayerInput ( .True )
    If *MB_StartingBadgesNumber > 0`
        Switch *MB_CurrentShip
        Case == 1`
            Call ShowMessageAtScreenPos    ( 002F0040  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[3] )
                Call AddBadge ( .Item:DodgeMaster *Var0 )
                Call ShowGotItem ( .Item:DodgeMaster .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 2`
            Call ShowMessageAtScreenPos    ( 002F0044  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[3] )
                Call AddBadge ( .Item:ZapTap *Var0 )
                Call ShowGotItem ( .Item:ZapTap .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 3`
            Call ShowMessageAtScreenPos    ( 002F0048  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[3] )
                Call AddBadge ( .Item:PowerBounce *Var0 )
                Call ShowGotItem ( .Item:PowerBounce .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 4`
            Call ShowMessageAtScreenPos    ( 002F004C  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[3] )
                Call AddBadge ( .Item:SleepStomp *Var0 )
                Call ShowGotItem ( .Item:SleepStomp .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        Case == 5`
            Call ShowMessageAtScreenPos    ( 002F0050  160`  40` ) % Badges!
            Call ShowChoice ( 002F0001 )
            If *Var0 == 00000000
                Call CloseMessage ()
                Call RemoveItemEntity ( *MapVar[3] )
                Call AddBadge ( .Item:MegaJump *Var0 )
                Call ShowGotItem ( .Item:MegaJump .True 00000000 )
                Sub *MB_StartingBadgesNumber 1`
                If *MB_StartingBadgesNumber == 0`
                    Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
                EndIf
                Unbind
            Else
                Call CloseMessage ()
            EndIf
        EndSwitch
    Else
        Call ShowMessageAtScreenPos    ( 002F0051  160`  40` ) % Done
    EndIf
    Call DisablePlayerInput ( .False )
    Return
    End
}

@ $Script_ToLaunchpad 
{
    SetGroup 0000001B
    Set *MF_NewSector .True
    Set *MB_CurrentNode 0`
    Call     UseExitHeading ( 60` ~Entry:Exit )
    Exec     ExitWalk
    Call GotoMapSpecial ( "sar_01" ~Entry:sar_01:Entry 0000000D )
    Wait  100`
    Return
    End
}

@ $Script_Callback_Start 
{
    If *MF_CompletedTutorial == .True
        Return
    EndIf
    Call DisablePlayerInput ( .True )
    Wait 30`
    Call SpeakToPlayer ( .NpcID:Astro 00830404 00830401 00000000 002F0063 )
    Call SetNpcAnimation ( .NpcID:Astro 00830402 )
    Call NpcMoveTo ( .NpcID:Astro -300` 200` 20` )
    Call SetNpcAnimation ( .NpcID:Astro 00830401 )
    Call SpeakToPlayer ( .NpcID:Astro 00830404 00830401 00000000 002F0064 )
    Call ShowChoice ( 002F0001 )
    If *Var0 == 00000000
        Call CloseMessage ()
        Call SpeakToPlayer ( .NpcID:Astro 00830404 00830401 00000000 002F0065 )
        Call GotoMapSpecial ( "sar_02" ~Entry:sar_02:Entry0 0000000D )
    Else
        Call CloseMessage ()
        Call SpeakToPlayer ( .NpcID:Astro 00830404 00830401 00000000 002F0066 )
        Call SetNpcAnimation ( .NpcID:Astro 00830402 )
        Call NpcMoveTo ( .NpcID:Astro -250` 250` 20` )
        Call SetNpcAnimation ( .NpcID:Astro 00830401 )
        Set *MF_CompletedTutorial .True
        Call DisablePlayerInput ( .False )
    EndIf
    Return
    End
}

@ $Script_Callback_AfterTutorial 
{
    Call DisablePlayerInput ( .True )
    Wait 30`
    Call SpeakToPlayer ( .NpcID:Astro 00830404 00830401 00000000 002F0076 )
    Call DisablePlayerInput ( .False )
    Return
    End
}

@ $Script_EnterMap 
{
    Call  GetEntryID    ( *Var[0] )
    Switch  *Var[0]
        Case  ==  ~Entry:TutorialEnd
            Exec  $Script_Callback_AfterTutorial
            Exec  $Script_CreateExitTriggers
        Case  ==  ~Entry:GameStart
            Exec  $Script_Callback_Start
            Exec  $Script_CreateExitTriggers
        Default
            Exec  $Script_CreateExitTriggers
    EndSwitch
    Return
    End
}
